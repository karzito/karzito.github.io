<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Web font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="ENTERPRISE: ISON" />
    <link rel="shortcut icon" href="http://localhost:4000/assets/built/images/favicon.png" type="image/png" />
    <link rel="canonical" href="http://localhost:4000/ict-ison-eskf1" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    
        <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
        equationNumbers: {
        autoNumber: "AMS"
        }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
    }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
        alert("Math Processing Error: "+message[1]);
    });
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
        alert("Math Processing Error: "+message[1]);
    });
</script>
<script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
    

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="POSTECH ICT V+ 4.0 CLASS" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1" />
    <meta property="og:description" content="ISON 개발 관련 목차 2021-03-02 ISON Meeting_1 2021-03-24 ISON Meeting_2 2021-04-07 ISON Development: Error-State Kalman Filter_1 2021-04-07 ISON Development: Error-State Kalman Filter_2 2021-04-26 ISON Development: Drone System Implementation 2021-05-10 ISON Development: Drone Control (1) 2021-06-10 ISON Development: Drone Control (2) 2021-07-23 ISON Internship 2021-08-25 ISON Internship final 2021-09-24 ISON Semester2" />
    <meta property="og:url" content="http://localhost:4000/ict-ison-eskf1" />
    <meta property="og:image" content="http://localhost:4000/assets/built/images/ictCover.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-04-07T08:11:00+09:00" />
    <meta property="article:modified_time" content="2021-04-07T08:11:00+09:00" />
    <meta property="article:tag" content="Ict" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1" />
    <meta name="twitter:description" content="ISON 개발 관련 목차 2021-03-02 ISON Meeting_1 2021-03-24 ISON Meeting_2 2021-04-07 ISON Development: Error-State Kalman Filter_1 2021-04-07 ISON Development: Error-State Kalman Filter_2 2021-04-26 ISON Development: Drone System Implementation 2021-05-10 ISON Development: Drone Control (1) 2021-06-10 ISON Development: Drone Control (2) 2021-07-23 ISON Internship 2021-08-25 ISON Internship final 2021-09-24 ISON Semester2" />
    <meta name="twitter:url" content="http://localhost:4000/" />
    <meta name="twitter:image" content="http://localhost:4000/assets/built/images/ictCover.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="POSTECH ICT V+ 4.0 CLASS" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ict" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "POSTECH ICT V+ 4.0 CLASS",
        "logo": "http://localhost:4000/"
    },
    "url": "http://localhost:4000/ict-ison-eskf1",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:4000/assets/built/images/ictCover.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/ict-ison-eskf1"
    },
    "description": "ISON 개발 관련 목차 2021-03-02 ISON Meeting_1 2021-03-24 ISON Meeting_2 2021-04-07 ISON Development: Error-State Kalman Filter_1 2021-04-07 ISON Development: Error-State Kalman Filter_2 2021-04-26 ISON Development: Drone System Implementation 2021-05-10 ISON Development: Drone Control (1) 2021-06-10 ISON Development: Drone Control (2) 2021-07-23 ISON Internship 2021-08-25 ISON Internship final 2021-09-24 ISON Semester2"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="http://localhost:4000/">POSTECH ICT V+ 4.0 CLASS</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-ict" role="menuitem"><a href="/tag/ict/">ICT V+ 4.0</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-ict post tag-python ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 7 April 2021"> 7 April 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ict/'>ICT</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1</h1>
            </header>
            
            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/ictCover.jpg)">
            </figure>
            
            -->
            
            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><span class="table-of-contents-list">ISON 개발 관련 목차 </span></p>
<ul class="table-of-contents-list">
    <li><a href="./ict-ison-meeting_1">2021-03-02 ISON Meeting_1</a></li>
    <li><a href="./ict-ison-meeting_2">2021-03-24 ISON Meeting_2</a></li>
    <li><a href="./ict-ison-eskf1">2021-04-07 ISON Development: Error-State Kalman Filter_1</a></li>
    <li><a href="./ict-ison-eskf2">2021-04-07 ISON Development: Error-State Kalman Filter_2</a></li>
    <li><a href="./ict-ison-imp">2021-04-26 ISON Development: Drone System Implementation</a></li>
    <li><a href="./ict-ison-ctrlr_1">2021-05-10 ISON Development: Drone Control (1)</a></li>
    <li><a href="./ict-ison-ctrlr_2">2021-06-10 ISON Development: Drone Control (2)</a></li>
    <li><a href="./ict-ison-internship">2021-07-23 ISON Internship</a></li>
    <li><a href="./ict-ison-internship2">2021-08-25 ISON Internship final</a></li>
    <li><a href="./ict-ison-semester2-plan">2021-09-24 ISON Semester2 Plan</a></li>
    <li><a href="./ict-ison-motor-ctrlr">2021-10-07 ISON Motor Controller Implementaion</a></li>
    <li><a href="./ict-ison-meeting_3">2021-10-26 ISON Meeting_3</a></li>
</ul>

<p>2021-03-24 ISON Meeting 포스팅에 게재했듯이, 혁신인재 4.0 이스온팀의 개발 목표는 <code class="highlighter-rouge">광학 측위 시스템 기반 precision landing</code> 기법을 연구하는 것이다. 연구를 위한 드론 기체 제작을 위해 주문한 부품 중 일부가 해외 배송 건으로, 도착하는데 시간이 걸리기 때문에 기체 제작에 앞서 세부 개발 목표 중 하나인 광학 측위 시스템을 활용한 navigation system 개발을 진행하도록 한다. Navigation system 알고리즘은 IMU 정보로 부터 계산한 측위 정보와 광학 측위 시스템을 기반으로 측정한 측위 정보를 error-state Kalman filter (ESKF)를 활용하여 fusion하는 형태로 구현한다. 해당 알고리즘은 다음의 논문을 참고하여 구현되었다: <a href="http://www.iri.upc.edu/people/jsola/JoanSola/objectes/notes/kinematics.pdf">Quaternion kinematics for the error-state Kalman filter</a><br /></p>

<p>본 포스팅에서 ESKF를 설명하기 위해서 true state, nominal state, 그리고 error state 라는 용어를 사용한다. True state는 추정하고자 하는 실제 state를 의미하며, nominal state는 IMU measurement 정보와 system kinematics를 활용하여 예측한 state를 의미한다. Error state는 ESKF에서 추정하는 state로 true state와 nominal state의 차이를 나타낸다.</p>

<p>위에서 간략히 언급한 바와 같이, 알고리즘은 다음과 같은 형태로 구성된다.</p>

<ol>
  <li>IMU measurement와 system kinematics를 활용한 nominal state prediction step</li>
  <li>광학 측위 시스템을 통해 측정된 드론의 position 및 attitude 정보를 이용한 error state correction step</li>
  <li>추정된 error state를 nominal state에 injection하여 true state를 추정하고, ESKF를 reset하는 step</li>
</ol>

<p>글의 목차는 다음과 같이 구성한다.</p>

<ol>
  <li>Nomenclature</li>
  <li>ESKF Prediction step</li>
  <li>ESKF Correction step</li>
  <li>ESKF Error-state injection and reset</li>
</ol>

<hr />

<h1 id="1-nomancalture"><strong>1. Nomancalture</strong></h1>

<table>
  <thead>
    <tr>
      <th>Magnitude</th>
      <th>True</th>
      <th>Nominal</th>
      <th>Error</th>
      <th>Composition</th>
      <th>Measure</th>
      <th>Noise</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Full state</td>
      <td>$x_{t}$</td>
      <td>$x$</td>
      <td>$\delta x$</td>
      <td>$x_{t} = x \oplus \delta x$</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Position</td>
      <td>$p_{t}$</td>
      <td>$p$</td>
      <td>$\delta p$</td>
      <td>$p_{t} = p + \delta p$</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Velocity</td>
      <td>$v_{t}$</td>
      <td>$v$</td>
      <td>$\delta v$</td>
      <td>$v_{t} = v + \delta v$</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Quaternion</td>
      <td>$q_{t}$</td>
      <td>$q$</td>
      <td>$\delta q$</td>
      <td>$q_{t} = q \otimes \delta q$</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Angles vector</td>
      <td> </td>
      <td> </td>
      <td>$\delta \theta $</td>
      <td>$\delta q = e^{\frac{\delta \theta}{2}}$</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Accelerometer bias</td>
      <td>$a_{bt} $</td>
      <td>$a_{b}$</td>
      <td>$\delta a_{b}$</td>
      <td>$a_{bt} = a_{b} + \delta a_{b}$</td>
      <td> </td>
      <td>$a_{w}$</td>
    </tr>
    <tr>
      <td>Gyrometer bias</td>
      <td>$\omega_{bt}$</td>
      <td>$\omega_{b}$</td>
      <td>$\delta \omega_{b}$</td>
      <td>$\omega_{bt} = \omega_{b} + \delta \omega_{b}$</td>
      <td> </td>
      <td>$\omega_{w}$</td>
    </tr>
    <tr>
      <td>Gravity vector</td>
      <td>$g_{t}$</td>
      <td>$g$</td>
      <td>$\delta g$</td>
      <td>$g_t = g + \delta g$</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Acceleration</td>
      <td>$a_{t}$</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>$a_{m}$</td>
      <td>$a_{n}$</td>
    </tr>
    <tr>
      <td>Angular rate</td>
      <td>$\omega_{t}$</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>$\omega_{m}$</td>
      <td>$\omega_{n}$</td>
    </tr>
  </tbody>
</table>

<p>단, $a_{t}$는 inertial frame 기준의 가속도를 나타내며,measured acceleration $a_{m}$은 가속도계에서 측정하는 값이므로 가속도계의 좌표계를 의미한다. 운용하고자 하는 가속도계는 드론 기체에 부착되어 있으므로, 드론 기체에 부착된 body frame 기준의 가속도를 나타낸다고 할 수 있다. $\oplus$는 generic composition을 의미한다. $\otimes$는 quaternion product를 의미한다.</p>

<h1 id="2-prediction-step"><strong>2. Prediction step</strong></h1>

<p><br /></p>

<h4 id="the-nominal-state-kinematics">The nominal state kinematics</h4>
<p>Nominal state의 differences equations는 아래와 같이 나타낼 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align} 
        \begin{split}
            p &\leftarrow p + v\triangle t + \frac{1}{2}\left(R\left(a_{m} - a_{b}\right) + g\right)\triangle t^{2} \\
            v &\leftarrow v + \left(R\left(a_{m} - a_{b}\right) + g\right)\triangle t \\
            q &\leftarrow q \otimes q\{(\omega_{m} - \omega_{b})\triangle t\} \\
            a_{b} &\leftarrow a_{b} \\
            \omega_{b} &\leftarrow \omega_{b} \\
            g &\leftarrow g
        \end{split} 
    \end{align} %]]></script>

<p>이 때, $x\leftarrow(x, \cdot)$은 $x_{k+1} = f(x_{k}, \cdot_{k})$와 같은 sequence update를 나타내며, $q{ v} $는 rotation $v$를 의미하는 quaternion이다.</p>

<h4 id="the-error-state-kinematics">The error-state kinematics</h4>
<p>True state kinematics 및 nominal state kinematics를 적절히 변형하여 다음과 같은 error-state kinematics를 얻을 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
        \begin{split}
            \delta p &\leftarrow \delta p + \delta v \triangle t \\
            \delta v &\leftarrow \delta v + (-R[ a_{m}-a_{b}]_{\times} \delta \theta - R\delta a_{b} + \delta g)\delta t + v_{i}   \\
            \delta \theta &\leftarrow R^{T}\{ (\omega_{m} - \omega_{b}\triangle t) \}\delta \theta - \delta \omega_{b} \triangle t + \theta_{i}  \\
            \delta a_{b} &\leftarrow \delta a_{b} + a_{i}    \\
            \delta \omega_{b} &\leftarrow \delta \omega_{b} + \omega_{i} \\
            \delta g &\leftarrow \delta g
        \end{split}
    \end{align} %]]></script>

<p>이 때, $v_{i}, \theta_{i}, a_{i}$ 그리고 $\omega_{i}$는 각각 velocity, orientation 그리고 bias estimates에 적용되는 random impulses로 white Gaussian process로 modeling 되었다. 각 값의 평균은 0이고 covariance matrices는 sensor noise 및 bias process noise ($a_{n}, \omega_{n}, a_{omega}$ 그리고 $\omega_{w}$)의 적분을 통해 구할 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
        \begin{split}
            V_{i} &= \sigma_{a_{n}}^2 \triangle t^2 I_{3\times 3} \\
            \Theta_{i} &= \sigma_{\omega_{n}}^2 \triangle t^2 I_{3\times 3} \\
            A_{i} &= \sigma_{a_{\omega}}^2 \triangle t I_{3\times 3} \\
            \Omega_{i} &= \omega_{\omega_{w}}^2 \triangle t I_{3\times 3}
            \label{eq:Cov_Mat_Elem}
        \end{split}
    \end{align} %]]></script>

<h4 id="the-erorr-state-jacobian-and-perturbation-matrices">The erorr-state Jacobian and perturbation matrices</h4>

<p>Error-state kinematics는 다음과 같이 선형 form으로 기술할 수 있다.</p>

<p><script type="math/tex">\begin{align}
        \begin{split}
            \delta x \leftarrow F_{x}(x, u_{m})\cdot \delta x + F_{i}\cdot i
        \end{split}
    \end{align}</script>
where,</p>

<script type="math/tex; mode=display">\begin{align*}
        \begin{split}
            u_{m} = \left[\begin{array}{cc}
            a_{m} \\
            \omega_{m} \end{array}\right], 
            i = \left[\begin{array}{cccc}
            v_{i} \\
            \theta_{i} \\
            a_{i} \\
            \omega_{i}
            \end{array}\right].
        \end{split}
    \end{align*}</script>

<p>ESKF의 prediction 수식은 위의 관계식들을 이용하여 다음과 같이 기술할 수 있다.</p>

<p><script type="math/tex">% <![CDATA[
\begin{align}
        \begin{split}
            \hat{\delta x} &\leftarrow F_{x}\cdot \hat{\delta x} \\
            P &\leftarrow F_{x}PF_{x}^{T}+F_{i}Q_{i}F_{i}^{T}
        \end{split}
    \end{align} %]]></script>
이 때, $\delta x$는 mean이 $\hat{\delta x}$이고 공분산이 $P$인 값이 된다. 또한 $F_{x}, F_{i}$는 각각 error-state kinematics와 관련된 Jacobian matrix이며, $Q_{i}$는 수식 (3)을 element로 하는 process noise matirx를 의미한다.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
        \begin{split}
            F_{x}=\frac{\partial f}{\partial \delta x}, F_{i}=\frac{\partial f}{\partial i}, 
            Q_{i} = \left[\begin{array}{cccccccccccccccc}
            V_i & 0 & 0 & 0 \\
            0 & \Theta_i & 0 & 0 \\
            0 & 0 & A_{i} & 0 \\
            0 & 0 & 0 & \Omega_{i}
            \end{array}\right]
        \end{split}
    \end{align} %]]></script>

<p>여기서 주목할 점은 error-state의 초깃값이 0이면 error-state는 항상 0으로 유지된다는 것이다. ESKF의 알고리즘 상 error-state는 correction을 통해서 추정되고 nominal state에 injection 된 후, 0으로 reset 되기 때문에 항상 0으로 유지되기 때문에 알고리즘을 구현할 때 따로 작성할 필요가 없다.</p>

<h1 id="3-correction-step"><strong>3. Correction step</strong></h1>

<p>광학 측위 시스템 기반의 측정값을 이용하여 error-state를 추정하고 이를 nominal state에 injection하여 true state를 추정한다. 광학 측위 시스템을 통해서 얻을 수 있는 measurements는 시스템의 position 및 attitude에 대한 quaternion vector이다.</p>

<h4 id="observation-of-the-error-state-via-filter-correction">Observation of the error state via filter correction</h4>
<p>Measurements가 아래와 같이 state-dependent function과 zero mean white Gaussian noise의 composition으로 나타난다고 가정하자.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        y = h(x_{t}) + v
    \end{split}
\end{align}</script>

<p>본 과제에서 활용하는 광학 측위 시스템의 경우 inertial frame 기준의 드론 position과 attitude를 측정하기 때문에 measurement function은 $h(x_{t}) = \left[\begin{array}{cc} p_{t} \ q_{t}\end{array}\right]^T$이며, V는 measurement noise covariance를 의미한다.</p>

<p>Error-state에 대한 estimation 및 error covariance matrix는 다음과 같이 갱신한다.
<script type="math/tex">% <![CDATA[
\begin{align}
    \begin{split}
        K &= PH^T (HPH^T + V)^{-1}   \\
        \hat{\delta x} &\leftarrow K(y - h(\hat{x_{t}})) \\
        P &\leftarrow (I-KH)P
    \end{split}
\end{align} %]]></script></p>

<p>이 때, $H$는 $h_{x_{t}}$에 대한 Jacobian matrix를 의미한다.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        H \equiv \left. \frac{\partial h}{\partial \delta x} \right\rvert_{x}
    \end{split}
\end{align}</script>

<h4 id="jacobian-computation-for-the-filter-correction">Jacobian computation for the filter correction</h4>
<p>Jacobian matrix $H$는 아래와 같이 chain rule을 활용하여 구할 수 있다.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        H \triangleq \left. \frac{\partial h}{\partial \delta x} \right\rvert_{x} = \left. \frac{\partial h}{\partial x_{t}} \right\rvert_{x} \left. \frac{\partial x_{t}}{\partial \delta x} \right\rvert_{x} = H_{x}X_{\delta x}
    \end{split}
\end{align}</script>

<p>Measurements는 position $p$와 quaternion $q$이기 때문에, $H_{x}$를 구하는 것은 trivial하다. $X_{\delta x}$는 정의에 따라 다음과 같이 얻을 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
    \begin{split}
        X_{\delta x} \triangleq \left. \frac{\partial x_{t}}{\partial \delta x} \right\rvert_{x} = \left[\begin{array}{ccccccccc} 
        I_{6\times 6} & 0 & 0 \\
        0 & Q_{\delta \theta} & 0 \\
        0 & 0 & I_{6\times 6} \end{array}\right]
    \end{split}
\end{align} %]]></script>

<p>이 때, $Q_{\delta \theta} = \partial(q\otimes \delta q) / \partial \delta \theta$를 의미하며, $\delta \theta$가 매우 작다고 가정하면 다음과 같이 구할 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
    \begin{split}
        Q_{\delta \theta} = \frac{1}{2} \left[\begin{array}{cccccccccccc}
        -q_{x} & -q_{y} & -q_{z} \\
        q_{w} & -q_{z} & q_{y} \\
        q_{z} & q_{w} & -q_{x} \\
        -q_{y} & q_{x} & q_{w} \end{array}\right]
    \end{split}
\end{align} %]]></script>

<h4 id="injection-of-the-observed-error-into-the-nominal-state">Injection of the observed error into the nominal state</h4>
<p>Nominal state는 estimated error-state를 이용하여 update할 수 있다.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        p \leftarrow p + \hat{\delta p} \\
        v \leftarrow v + \hat{\delta v} \\
        q \leftarrow q \otimes q\{\hat{\delta \theta}\}  \\
        a_{b} \leftarrow a_{b} + \hat{\delta a_{b}} \\
        \omega_{b} \leftarrow \omega_{b} + \hat{\delta \omega_{b}}  \\
        g \leftarrow g + \hat{\delta g}
    \end{split}
\end{align}</script>

<h1 id="4-eskf-reset"><strong>4. ESKF reset</strong></h1>
<p>Error state의 초기화는 다음과 같은 형태로 이루어진다.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        \delta x = \delta x \ominus \hat{\delta x}
    \end{split}
\end{align}</script>

<p>따라서 이에 대한 ESKF reset operation은 다음과 같이 나타난다.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        \hat{\delta x} \leftarrow 0 \\
        P \leftarrow GPG^T
    \end{split}
\end{align}</script>

<p>이 때, G는 아래와 같이 정의된 Jacobian matrix를 의미한다.</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        G \triangleq \left. \frac{\partial g}{\partial \delta x} \right\rvert_{\hat{\delta x}}
    \end{split}
\end{align}</script>

<hr />

<p>다음 포스팅은 해당 알고리즘에 대한 c 코드 작성에 대한 내용을 담을 예정이다. 이 후, 드론 기체 제작에 필요한 부품들이 모두 도착하면 기체를 제작하고 알고리즘 검증과 관련된 내용을 진행하도록 한다.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/quantum.png" alt="karzito" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/karzito">ChangHyeon Lee</a></h4>
                                
                                    <p>ph.D student in electrical engineering at POSTECH, Computing and Control Engineering Lab (CoCEL)</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/karzito">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/rainSurfing4.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; POSTECH ICT V+ 4.0 CLASS &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ict/">Ict</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ict-ison-meeting_3">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-10-26 크로스터치 워크샵 관련 미팅</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ict-ison-motor-ctrlr">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-10-07 모터 제어</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ict-ison-semester2-plan">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-09-24 2학기 진행 계획</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ict/">
                                
                                    See all 11 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ict-ison-eskf2">
                <div class="post-card-image" style="background-image: url(/assets/built/images/ictCover.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ict-ison-eskf2">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ict</span>
                            
                        
                    

                    <h2 class="post-card-title">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/quantum.png" alt="ChangHyeon Lee" />
                        
                        <span class="post-card-author">
                            <a href="/author/karzito/">ChangHyeon Lee</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card ">
        
            <a class="post-card-image-link" href="/markdown-tutorial">
                <div class="post-card-image" style="background-image: url(/assets/built/images/writing.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/markdown-tutorial">
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">[Markdown Tutorial] 마크다운 기본 문법 정리</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/quantum.png" alt="ChangHyeon Lee" />
                        
                        <span class="post-card-author">
                            <a href="/author/karzito/">ChangHyeon Lee</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:4000/">
            
            <span>POSTECH ICT V+ 4.0 CLASS</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=POSTECH+ICT+V%2B+4.0+%EB%A7%A4%EC%B9%AD+%EA%B8%B0%EC%97%85+ISON+2021-04-07+Navigation+System+Implementation+using+Error-State+Kalman+Filter_1&amp;url=https://karzito.github.io/ict-ison-eskf1"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://karzito.github.io/ict-ison-eskf1"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:4000/">POSTECH ICT V+ 4.0 CLASS</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
