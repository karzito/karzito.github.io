<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Web font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="ENTERPRISE: ISON" />
    <link rel="shortcut icon" href="http://localhost:4000/assets/built/images/favicon.png" type="image/png" />
    <link rel="canonical" href="http://localhost:4000/ict-ison-eskf2" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    
        <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
        equationNumbers: {
        autoNumber: "AMS"
        }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
    }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
        alert("Math Processing Error: "+message[1]);
    });
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
        alert("Math Processing Error: "+message[1]);
    });
</script>
<script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
    

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="POSTECH ICT V+ 4.0 CLASS" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2" />
    <meta property="og:description" content="ISON 개발 관련 목차 2021-03-02 ISON Meeting 2021-03-24 ISON Meeting 2021-04-07 ISON Development: Error-State Kalman Filter_1 2021-04-07 ISON Development: Error-State Kalman Filter_2 본 포스팅에서는 지난 시간에 정리한 Error-State Kalman Filter의 process 및 measurement noise matrices 계수 설정, 구현 코드 관련된 내용을 작성하고자 한다. 1. Process noise &amp; measurement noise matricies" />
    <meta property="og:url" content="http://localhost:4000/ict-ison-eskf2" />
    <meta property="og:image" content="http://localhost:4000/assets/built/images/ictCover.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-04-21T08:11:00+09:00" />
    <meta property="article:modified_time" content="2021-04-21T08:11:00+09:00" />
    <meta property="article:tag" content="Ict" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2" />
    <meta name="twitter:description" content="ISON 개발 관련 목차 2021-03-02 ISON Meeting 2021-03-24 ISON Meeting 2021-04-07 ISON Development: Error-State Kalman Filter_1 2021-04-07 ISON Development: Error-State Kalman Filter_2 본 포스팅에서는 지난 시간에 정리한 Error-State Kalman Filter의 process 및 measurement noise matrices 계수 설정, 구현 코드 관련된 내용을 작성하고자 한다. 1. Process noise &amp; measurement noise matricies" />
    <meta name="twitter:url" content="http://localhost:4000/" />
    <meta name="twitter:image" content="http://localhost:4000/assets/built/images/ictCover.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="POSTECH ICT V+ 4.0 CLASS" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ict" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "POSTECH ICT V+ 4.0 CLASS",
        "logo": "http://localhost:4000/"
    },
    "url": "http://localhost:4000/ict-ison-eskf2",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:4000/assets/built/images/ictCover.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/ict-ison-eskf2"
    },
    "description": "ISON 개발 관련 목차 2021-03-02 ISON Meeting 2021-03-24 ISON Meeting 2021-04-07 ISON Development: Error-State Kalman Filter_1 2021-04-07 ISON Development: Error-State Kalman Filter_2 본 포스팅에서는 지난 시간에 정리한 Error-State Kalman Filter의 process 및 measurement noise matrices 계수 설정, 구현 코드 관련된 내용을 작성하고자 한다. 1. Process noise &amp; measurement noise matricies"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="http://localhost:4000/">POSTECH ICT V+ 4.0 CLASS</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-ict" role="menuitem"><a href="/tag/ict/">ICT V+ 4.0</a></li>
    <li class="nav-qCom" role="menuitem"><a href="/tag/quantum/">Quantum Computing</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-ict post tag-python ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="21 April 2021">21 April 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ict/'>ICT</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2</h1>
            </header>
            
            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/ictCover.jpg)">
            </figure>
            
            -->
            
            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><span class="table-of-contents-list">ISON 개발 관련 목차 </span></p>
<ul class="table-of-contents-list">
    <li><a href="./ict-ison-meeting">2021-03-02 ISON Meeting</a></li>
    <li><a href="./ict-ison-meeting">2021-03-24 ISON Meeting</a></li>
    <li><a href="./ict-ison-eskf1">2021-04-07 ISON Development: Error-State Kalman Filter_1</a></li>
    <li><a href="./ict-ison-eskf2">2021-04-07 ISON Development: Error-State Kalman Filter_2</a></li>
</ul>

<p>본 포스팅에서는 지난 시간에 정리한 <code class="highlighter-rouge">Error-State Kalman Filter</code>의 process 및 measurement noise matrices 계수 설정, 구현 코드 관련된 내용을 작성하고자 한다.</p>

<h1 id="1-process-noise--measurement-noise-matricies"><strong>1. Process noise &amp; measurement noise matricies</strong></h1>
<p>각 states에 process 및 measurement noise들은 각각 독립적이라고 가정한다. 이 때, 논문의 정의에 따른 noise matrix를 구성하기 위해서 연구실에서 활용하는 드론의 hovering state에서 측정한 센서 정보들을 사용한다. Quadcopter의 hovering state에서 가속도계 및 자이로스코프의 measurement 정보는 다음과 같다.</p>

<p align="center">
    <img src="assets/built/images/ESKF/acc_in_hovering.jpg" alt="acc_hovering" />
    <img src="assets/built/images/ESKF/gyro_in_hovering.jpg" alt="gyro_hovering" />
    Accelerometer &amp; Gyroscope measurements in quadcopter's hovering states
</p>

<p>해당 데이터 정보를 기반으로 필요한 process noise covariance matrix를 구성할 수 있으며, 각각의 variance는 다음과 같이 나타난다.</p>

<table>
  <tbody>
    <tr>
      <td> </td>
      <td>Acc measurements</td>
      <td>Gyromeasurements</td>
      <td>Acc bias</td>
      <td>Gyro bias</td>
    </tr>
    <tr>
      <td>Variance</td>
      <td>0.3 [$m/s^2$]</td>
      <td>0.0005 [$rad/s$]</td>
      <td>0.1 [$m/s^2$]</td>
      <td>1 [$deg/s$]</td>
    </tr>
  </tbody>
</table>

<p>따라서 process noise covariance matrix는 다음과 같다.
<script type="math/tex">% <![CDATA[
\begin{align}
    \begin{split}
        Q_{i} = \left[\begin{array}{cccccccccccccccc}
            V_i & 0 & 0 & 0 \\
            0 & \Theta_i & 0 & 0 \\
            0 & 0 & A_{i} & 0 \\
            0 & 0 & 0 & \Omega_{i}
            \end{array}\right]
    \end{split}
\end{align} %]]></script>
where,</p>

<script type="math/tex; mode=display">\begin{align}
    \begin{split}
        V_i = 0.3  \triangle t^2            \\
        \Theta_i = 0.0005  \triangle t^2       \\
        A_i = 0.1  \triangle t^2            \\
        \Omega_i = \frac{\pi}{180}  \triangle t^2       \\
    \end{split}
\end{align}</script>

<p>모션 캡처 시스템인 <code class="highlighter-rouge">Optitrack</code>으로 부터 획득되는 measurements의 noise covariance는 다음의 calibration 정보를 기반으로 측정하였다.</p>

<p>이에 대한 결과는 다음과 같이 나탄나다.</p>

<table>
  <tbody>
    <tr>
      <td> </td>
      <td>Quaternion</td>
      <td>Position</td>
    </tr>
    <tr>
      <td>Variance</td>
      <td>$0.0017^2$ [$rad^2/s^2$]</td>
      <td>$0.001^2$ [$m^2$]</td>
    </tr>
  </tbody>
</table>

<p>위의 계수를 이용하여 ESKF 알고리즘을 구성하고 기존에 획득한 비행 정보를 이용하여 알고리즘을 테스트하였으며 결과는 다음과 같이 나타난다.</p>

<p align="center">
    <img src="assets/built/images/ESKF/ESKF_Pos.jpg" alt="ESKF_Pos" />
    <img src="assets/built/images/ESKF/ESKF_Quat.jpg" alt="ESKF_Quat" />
    EKSF Algorithm test results
</p>

<p>구현 코드는 다음과 같다.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="n">statePropagate</span><span class="p">(</span><span class="k">struct</span> <span class="n">structOPTINS</span> <span class="o">*</span><span class="n">ins</span><span class="p">,</span> <span class="k">struct</span> <span class="n">structOPTPAR</span> <span class="n">insPar</span><span class="p">,</span> <span class="kt">float</span> <span class="n">gyro</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="n">acc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="n">dt</span><span class="p">){</span>
	
	<span class="k">const</span> <span class="kt">float</span> <span class="n">dtHalf</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">float</span> <span class="n">dtSqHalf</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="p">;</span>
	
	<span class="c1">// Nominal state prediction
</span>	<span class="kt">float</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">float</span> <span class="n">dOmg</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">qdOmg</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">dOmgNorm</span><span class="p">,</span> <span class="n">sinOmg</span><span class="p">,</span> <span class="n">tempQuat</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">float</span> <span class="n">ax</span> <span class="o">=</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]),</span> <span class="n">ay</span> <span class="o">=</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span> <span class="n">az</span> <span class="o">=</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">12</span><span class="p">]);</span>
	<span class="kt">float</span> <span class="n">gx</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">13</span><span class="p">]),</span> <span class="n">gy</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">]),</span> <span class="n">gz</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">15</span><span class="p">]);</span>
	<span class="n">quat2Rot</span><span class="p">(</span><span class="n">rotMat</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]));</span>
	<span class="c1">// Position
</span>	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ay</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">az</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span><span class="o">*</span><span class="n">dtSqHalf</span><span class="p">;</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ay</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">az</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span><span class="o">*</span><span class="n">dtSqHalf</span><span class="p">;</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ay</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">az</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span><span class="o">*</span><span class="n">dtSqHalf</span><span class="p">;</span>
	<span class="c1">// Velocity
</span>	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ay</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">az</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ay</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">az</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ay</span> <span class="o">+</span> <span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">az</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
	<span class="c1">// Quaternion
</span>	<span class="n">dOmg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gx</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">dOmg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gy</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">dOmg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gz</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
	<span class="n">dOmgNorm</span> <span class="o">=</span> <span class="n">vecNorm</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">dOmg</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="n">sinOmg</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">dOmgNorm</span><span class="p">);</span>
	<span class="n">qdOmg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">dOmgNorm</span><span class="p">);</span> <span class="n">qdOmg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dOmg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dOmgNorm</span><span class="p">)</span><span class="o">*</span><span class="n">sinOmg</span><span class="p">;</span> <span class="n">qdOmg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dOmg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dOmgNorm</span><span class="p">)</span><span class="o">*</span><span class="n">sinOmg</span><span class="p">;</span> <span class="n">qdOmg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dOmg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">dOmgNorm</span><span class="p">)</span><span class="o">*</span><span class="n">sinOmg</span><span class="p">;</span>
	<span class="n">qMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempQuat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">qdOmg</span><span class="p">));</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQuat</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQuat</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQuat</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQuat</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	
	
	<span class="c1">// Error-state prediction: Please note that, being the mean of the error initialized to zero, the error-state prediction always returns zero
</span>	
	
	<span class="c1">// Error-state jacobian matrix
</span>	<span class="c1">// Accelerometer skew matrix
</span>	<span class="kt">float</span> <span class="n">skewAcc</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">az</span><span class="p">,</span> <span class="n">ay</span><span class="p">},</span>
	                       <span class="p">{</span><span class="n">az</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">ax</span><span class="p">},</span>
	                       <span class="p">{</span><span class="o">-</span><span class="n">ay</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">}};</span>
	<span class="kt">float</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="p">},</span> <span class="n">Fi</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="p">},</span> <span class="n">Fit</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
	<span class="kt">float</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
	<span class="c1">// Jacobian matrix
</span>	<span class="c1">// Position
</span>	<span class="n">Fx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
	<span class="c1">// Velocity
</span>	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempMat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">rotMat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">skewAcc</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
	<span class="c1">// Angle error
</span>	<span class="n">quat2Rot</span><span class="p">(</span><span class="n">tempMat</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">qdOmg</span><span class="p">));</span>
	<span class="n">matTransposeSelf</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempMat</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span> <span class="n">Fx</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt</span><span class="p">;</span>
	<span class="c1">// Accelerometer bias
</span>	<span class="n">Fx</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">11</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="c1">// Gyroscope bias
</span>	<span class="n">Fx</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="c1">// Gravitational acceleration
</span>	<span class="n">Fx</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">16</span><span class="p">][</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">Fx</span><span class="p">[</span><span class="mi">17</span><span class="p">][</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	
	
	<span class="c1">// Error-state input matrix (Noise jacobian matrix)
</span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">12</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Fi</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	
	
	<span class="c1">// Error covariance matrix update
</span>	<span class="c1">// P = Fx*P*Fx' + Fi*Qi*Fi'
</span>	<span class="kt">float</span> <span class="n">tempP</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">18</span><span class="p">],</span> <span class="n">tempQ</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">12</span><span class="p">];</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fx</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matTransposeSelf</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fx</span><span class="p">),</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fx</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempQ</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fi</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">insPar</span><span class="p">.</span><span class="n">Qi</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">matTranspose</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fit</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fi</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempQ</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Fit</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	
	<span class="n">matAdd</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	
<span class="c1">//	float qNorm = vecNorm((float*)(&amp;ins-&gt;x[6]), 4);
//	ins-&gt;x[6] = ins-&gt;x[6]/qNorm; ins-&gt;x[7] = ins-&gt;x[7]/qNorm; ins-&gt;x[8] = ins-&gt;x[8]/qNorm; ins-&gt;x[9] = ins-&gt;x[9]/qNorm;
</span><span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">optitrackUpdate</span><span class="p">(</span><span class="k">struct</span> <span class="n">structOPTINS</span> <span class="o">*</span><span class="n">ins</span><span class="p">,</span> <span class="k">struct</span> <span class="n">structOPTPAR</span> <span class="n">insPar</span><span class="p">,</span> <span class="kt">float</span> <span class="n">optiQuat</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kt">float</span> <span class="n">optiPos</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">{</span>
	
	<span class="c1">// Measurement matrix
</span>	<span class="kt">float</span> <span class="n">H</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
	<span class="kt">float</span> <span class="n">qw</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">qx</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">qy</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">qz</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qx</span><span class="p">;</span> <span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qy</span><span class="p">;</span> <span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qz</span><span class="p">;</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qw</span><span class="p">;</span>  <span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qz</span><span class="p">;</span> <span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qy</span><span class="p">;</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qz</span><span class="p">;</span>  <span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qw</span><span class="p">;</span>  <span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qx</span><span class="p">;</span>
	<span class="n">H</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qy</span><span class="p">;</span> <span class="n">H</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qx</span><span class="p">;</span>  <span class="n">H</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">qw</span><span class="p">;</span>
	
	
	<span class="c1">// Kalman gain update
</span>	<span class="kt">float</span> <span class="n">tempH</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">18</span><span class="p">],</span> <span class="n">Ht</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">7</span><span class="p">];</span>
	<span class="kt">float</span> <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="n">invS</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">7</span><span class="p">];</span>
	<span class="kt">float</span> <span class="n">K</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="n">tempK</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempH</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">H</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matTranspose</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Ht</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">H</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">S</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempH</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Ht</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	<span class="n">matAdd</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">S</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">S</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">insPar</span><span class="p">.</span><span class="n">Ri</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">matCholInv</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">S</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">S</span><span class="p">),</span> <span class="mi">7</span><span class="p">);</span>
	
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempK</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">Ht</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">K</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempK</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">S</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	
	
	<span class="c1">// Residual calculation
</span>	<span class="kt">float</span> <span class="n">res</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiPos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiQuat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiQuat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiQuat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">res</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">optiQuat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
	<span class="c1">// Error state correction
</span>	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">K</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">res</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	
	
	<span class="c1">// Error covariance correction
</span>	<span class="kt">float</span> <span class="n">tempMat</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">18</span><span class="p">],</span> <span class="n">tempP</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">18</span><span class="p">];</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempMat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">K</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">H</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="c1">// I - KH
</span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">18</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">18</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">tempMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">tempMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">tempMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tempMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="c1">// P = (I - KH)P
</span>	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempMat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matCopy</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	
	
	<span class="c1">// Injection of the observed errors into the nominal states
</span>	<span class="c1">// Position &amp; Velocity
</span>	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="c1">// Quaternion
</span>	<span class="kt">float</span> <span class="n">dqNorm</span> <span class="o">=</span> <span class="n">vecNorm</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">3</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">sinNorm</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">dqNorm</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">qdq</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">cos</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">dqNorm</span><span class="p">),</span> <span class="p">(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">/</span><span class="n">dqNorm</span><span class="p">)</span><span class="o">*</span><span class="n">sinNorm</span><span class="p">,</span> <span class="p">(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="n">dqNorm</span><span class="p">)</span><span class="o">*</span><span class="n">sinNorm</span><span class="p">,</span> <span class="p">(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">/</span><span class="n">dqNorm</span><span class="p">)</span><span class="o">*</span><span class="n">sinNorm</span><span class="p">};</span>
	<span class="kt">float</span> <span class="n">tempQ</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">qMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempQ</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">qdq</span><span class="p">));</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQ</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQ</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQ</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempQ</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="c1">// Bias &amp; Gravitational acceleration
</span>	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
	<span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
		
		
	<span class="c1">// Error covariance reset
</span>	<span class="kt">float</span> <span class="n">G</span><span class="p">[</span><span class="mi">18</span><span class="p">][</span><span class="mi">18</span><span class="p">];</span>
	<span class="n">matEye</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">G</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">G</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="n">G</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">G</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="n">G</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">G</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span> <span class="n">G</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">dx</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="c1">// P = GPG'
</span>	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempMat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">G</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matTransposeSelf</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">G</span><span class="p">),</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matMult</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempMat</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">G</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matCopy</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
		
		
	<span class="c1">// Make P symmetric
</span>	<span class="n">matTranspose</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="n">matAdd</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">tempP</span><span class="p">),</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">),</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">18</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">18</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">ins</span><span class="o">-&gt;</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
		
<span class="c1">//	float qNorm = vecNorm((float*)(&amp;ins-&gt;x[6]), 4);
//	ins-&gt;x[6] = ins-&gt;x[6]/qNorm; ins-&gt;x[7] = ins-&gt;x[7]/qNorm; ins-&gt;x[8] = ins-&gt;x[8]/qNorm; ins-&gt;x[9] = ins-&gt;x[9]/qNorm;
</span>	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/quantum.png" alt="karzito" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/karzito">ChangHyeon Lee</a></h4>
                                
                                    <p>ph.D student in electrical engineering at POSTECH, Computing and Control Engineering Lab (CoCEL)</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/karzito">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/rainSurfing4.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; POSTECH ICT V+ 4.0 CLASS &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ict/">Ict</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ict-ison-eskf1">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ict-ison-meeting">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-03-24 미팅 요약</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ict-ison-meeting">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-03-02 미팅 요약</a></li>
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ict/">
                                
                                    See all 3 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ict-ison-eskf1">
                <div class="post-card-image" style="background-image: url(/assets/built/images/ictCover.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ict-ison-eskf1">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ict</span>
                            
                        
                    

                    <h2 class="post-card-title">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_1</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/quantum.png" alt="ChangHyeon Lee" />
                        
                        <span class="post-card-author">
                            <a href="/author/karzito/">ChangHyeon Lee</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:4000/">
            
            <span>POSTECH ICT V+ 4.0 CLASS</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">POSTECH ICT V+ 4.0 매칭 기업 ISON 2021-04-07 Navigation System Implementation using Error-State Kalman Filter_2</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=POSTECH+ICT+V%2B+4.0+%EB%A7%A4%EC%B9%AD+%EA%B8%B0%EC%97%85+ISON+2021-04-07+Navigation+System+Implementation+using+Error-State+Kalman+Filter_2&amp;url=https://karzito.github.io/ict-ison-eskf2"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://karzito.github.io/ict-ison-eskf2"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:4000/">POSTECH ICT V+ 4.0 CLASS</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
